Exploit CVE-2023-22515 to get admin access to Confluence Server and Data Center editions.
An attacker can exploit the vulnerability and get access to the server to create and use an account with Full Admin Rights
The vulnerability is categorized as a Broken Access Control issue and has a CVSS base score of 10.0
###
http://10.10.22.163:8090/setup/
in this page u go thru the initial setup for an Admin account
everything's regular here
-follow to get to the CVE
because that page tells you the setup is already completed, ok but the CVE reenables you to create a NEW Full Admin Account
"This is all possible because Confluence is built using the Apache Struts framework, which depends on the XWork package. XWork allows you to define Actions in the form of a Java class. Each Action can be invoked through a URL, and the corresponding Java class will handle the request, do whatever the Action requires, and emit a response."
#
how do these actions work, tho?
to see it we just go to the URL 10.10.22.163:8090/
and we'll be redirected to /login.action
Why? 
Because the URL calls for an Action that triggers an Java class to handle logins
"When an Action is invoked through its URL, the execute() method of the class will be called by default."
#
#
#
Getters & Setters
we can also uses getters/setters in XWork directly in the URL if there is any in the Action class
for example: if /login.action had a setId() setter 
then we could use /login.action?Id=123
which would execute setId('123')
#
ServerInfoAction Action
"The reported exploit takes advantage of the ServerInfoAction Action. The reason for picking this specific Action is that we can build a chain of getters/setters from it to set the configuration parameter that turns the initial setup on or off.
If you analyse the code of the ServerInfoAction class, you'll see it extends the ConfluenceActionSupport class. By doing so, it will inherit all of its methods as well."
#
BootstrapStatusProvider Object
"One such method is a getter that returns a BootstrapStatusProvider object"
We care about the BootstrapStatusProvider class because it has another getter method we can use to retrieve an ApplicationConfiguration object
#
ApplicationConfiguration Object
We care about this for obvious reasons, this will get us the app config
including an attribute that tells Confluence if the initial setup has been finished. Such attribute can be modified by using a setter in the ApplicationConfig class
#
setSetupComplete(false)
this effectively calls for the initial setup to be On and reenables it
#
#
#
http://10.10.22.163:8090/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false
to put it together
This will be effectively translated by XWork into a call to:
getBootstrapStatusProvider().getApplicationConfig().setSetupComplete(false)
#
/setup/setupadministrator-start.action
after triggering the vulnerability we can get to setup the admin account
#
after configuring and logging in - here we have successfully exploited the vulnerability to gain access as a Super Admin
